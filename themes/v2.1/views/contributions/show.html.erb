<%

  # @javascripts[:images_lazy_load] = true
  @javascripts[:gmap_display] = true
  @javascripts[:images_loaded] = true
  @javascripts[:carousel] = true
  @javascripts[:truncate] = true
  @javascripts[:lightbox] = true
  @javascripts[:translate] = true
  @javascripts[:contributions_show] = true
  @javascripts[:audio] = @contribution.attachments.select(&:audio?).present?
  @javascripts[:video] = @contribution.attachments.select(&:video?).present?
  @javascripts[:annotorious] = true
  @title = contribution_title(@contribution)
  
  @stylesheets[:item] = true
  
%>

<% if current_user.may_edit_contribution?(@contribution) || current_user.may_delete_contribution?(@contribution) || current_user.may_approve_contributions? -%>
  <div class="section action-links top">
    <ul>
    <% if current_user.may_edit_contribution?(@contribution) %>
      <% if @contribution.draft? %>
      <%= form_previous_step_link edit_contribution_path(@contribution) %>
      <% end %>
      <li><%= link_to t('actions.edit'), edit_contribution_path(@contribution) %></li>
    <% end %>
    <%- if current_user.may_create_contribution_attachment?(@contribution) -%>
      <li><%= link_to t('formtastic.actions.attachment.add_edit'), ( new_contribution_attachment_path(@contribution) ) %> (<%= @contribution.attachments.size %>)</li>
    <% end %>
    <%- if current_user.may_withdraw_contribution?(@contribution) -%>
      <li><%= link_to t('formtastic.actions.contribution.withdraw'), ( withdraw_contribution_path(@contribution ) ) %></li>
    <%- end -%>
    <% if current_user.may_delete_contribution?(@contribution) %><li><%= link_to t('actions.delete'), delete_contribution_path(@contribution) %></li><% end %>
    <%- if current_user.may_view_contribution_status_log?(@contribution) -%>
      <li><%= link_to( t('views.contributions.status.title'), status_contribution_path(@contribution) ) %></li>
    <%- end -%>
    <%- if current_user.may_approve_contributions? && @contribution.pending_approval? %>
      <li><%= button_to t('actions.approve'), approve_contribution_path(@contribution), :method => :put %></li>
    <%- end %>
    <%- if current_user.may_reject_contributions? && @contribution.pending_approval? %>
      <li><%= button_to t('actions.reject'), reject_contribution_path(@contribution), :method => :put %></li>
    <%- end %>
    </ul>
  </div>
<% end -%>




<!-- 
<div class="section top">
-->

<!-- NEW GRID -->
<div class="container">  
  
  <div class="col left">

    <div class="col-cell show-on-item-collapsed" >
      <h2><%= contribution_title(@contribution) %></h2>
    </div>

	<%# placeholder for translate tool  -%>
	
    <div class="col-cell translate-area-mobile show-on-item-collapsed" >
    </div>
    
	<%# translation for map heading -%>
	
	<script type="text/javascript">
		window.translated_map_contribution_heading = '<%= t("common.translated_map_contribution_heading") %>';
	</script>
    
    <%- if referred_by_search? -%>
      <div class="col-cell hide-on-item-collapsed" >
	      <%#= link_to t('views.links.back-to-search'), :back, :class => 'return-to-results' %>
	      <%= link_to t('views.links.back-to-search'), :back %>
	  </div>
    <%- end -%>

    <div class="col-cell" >
      <%= render :partial => '/attachments/carousel', :locals => { :contribution => @contribution, :attachments => @attachments } %>
    </div>
    
    <div class="col-cell" >
      <ul id="thumbnail-counts"></ul>
  	</div>  
    
    <!-- <div id="banner"> -->
    <%
    #  render :partial => '/blog_posts/list',
    #  :locals => {
    #    :blog => 'europeana',
    #    :category => 'story-banner',
    #    :relocale => true,
    #    :deblogger => true
    #  }
    %>
    <!-- </div> -->
    
    <%= render :partial => '/layouts/navigation/sharethis' %>

    <div class="col-cell" >
	    <dl id="story-metadata" class="metadata show-on-item-collapsed">
	    

	   	    <%=
		      render :partial => '/metadata/wrap_display',
		      :locals => {
		      :show_title => false,
		      :contribution => @contribution,
		      :metadata => @contribution.metadata,
		      :field_options => {
		        :cataloguing => false, 
		        :contribution => true,
		        :name => [
		        'alternative',        
		        'description',
		        'creator_family_name',
		        'creator_given_name',
		        ],
		        :name_order => true
		      }
		      }
		    %>
		 </dl>
  	</div>  
    
  </div>

  <div class="col middle">
  
      <div class="col-cell hide-on-item-collapsed" >
        <h2><%= contribution_title(@contribution) %></h2>
      </div>

      <div class="col-cell translate-area hide-on-item-collapsed" >
      </div>

	  <div id="story-info" class="col-cell hide-on-item-collapsed">
	    
	    
	   	    <%=
		      render :partial => '/metadata/wrap_display',
		      :locals => {
		      :show_title => false,
		      :contribution => @contribution,
		      :metadata => @contribution.metadata,
		      :field_options => {
		        :cataloguing => false, 
		        :contribution => true,
		        :name => [
		        'alternative',        
		        'description',
		        'creator_family_name',
		        'creator_given_name',
		        ],
		        :name_order => true
		      }
		      }
		    %>    
	    
	  </div>
	  
	</div>
</div>
