
===   history   ===
2012-01-12 jaclu added setup instructions
2012-01-09 jaclu initial far from complete version
2012-01-17 dan entous : added redirects
2012-01-24 dan entous : added secret token and db migrate
2012-01-26 jaclu: started to list system dependencies

dummy text testing hudson autobuild

===   Background   ===

Currently there is no obvious way to actually install this software,
here I am trying to document the steps needed for a fresh start.
This is a work in progress for the moment...

===   setup environment   ===

  == system dependencies ==
  
    = imagemagick =
      http://www.imagemagick.org/
	  aptitude install imagemagic
      
	  make sure jpeg deligate is installed : at console "convert -list configure",
	  you should see something like this : "DELEGATES     bzlib jpeg x11 xml zlib"
	  
	  if not you'll need to install the jpeg delegate library
	  http://www.imagemagick.org/download/delegates/jpegsrc.v8b.tar.gz
	  
	  and then re-run ImageMagick/GraphicsMagick's ./configure script
	  sudo make and sudo make install

    = sphinx =
      http://sphinxsearch.com/
      
      Download and install Sphinx as per system OS/distribution convention, so 
      that its binaries, including "indexer" are available on the environment 
      path. From the RunCoCo application installation directory, run:
      
        RAILS_ENV=production bundle exec ts:config
        
      Configure Sphinx to use the configuration file generated by the above --
      "$RAILS_ROOT/config/production.sphinx.conf" -- where $RAILS_ROOT is the
      RunCoCo installation directory (and assuming the production environment).
      
      Create an initial index of the database by running:
      
        RAILS_ENV=production bundle exec ts:index
      
      Start Sphinx as a system service/daemon, and configure to start on system
      boot. Restart the RunCoCo web application/service/daemon.

checkout this sourcetree

Install ruby

gem install bundle passenger

[in 1914 topdir]

bundle install  [user needs sudo privs]




===   setup database   ===

In config/database.yml make sure you have prepared both development
AND test with database,user and pw.   All doc tells you to only do development, but in order to
run this test is also needed. 
The test database will be created in the db:create step below, nothing
will actually be put into it. To make life easier for you keep the
dev,test and prod database privs separate, so you are sure how your
system talks to your db.


at prompt:

rake db:create  
rake db:schema:load
rake db:sessions:create

===   running server interactivly   ===
[in 1914 topdir]

rails server

===   clear gems   ===
this should hopefully remove all gems so you can start with a fresh
environment.

gem uninstall will_paginate warden tzinfo treetop thor thinking-sphinx sax-machine rspec-rails rspec-mocks rspec-expectations rspec-core rspec riddle rake railties rails rack-test rack-mount rack polyglot paperclip nokogiri mysql2 mime-types mail loofah i18n i18n-js http_accept_language hpricot globalize3 formtastic feedzirra fastercsv erubis diff-lcs devise curb cocaine bundler bundle builder bcrypt-ruby arel aegis activesupport activeresource activerecord activemodel actionpack actionmailer abstract passenger




=== secret_token ===
/config/initializers/secret_token.rb
change CoCoCo::Application.config.secret_token
to RunCoCo::Application.config.secret_token


=== db updates ===
Run `bundle exec rake db:migrate` on existing installations to :
    1. apply changes to db structure for contribution/attachment field distinction.
    2. make existing fields contributor-editable, and set them as applicable to the story, digital object or both.


=== user picture images ===
The directory "public/images/users" needs to be writeable by the web server
process.


===  redirects  ===
the following redirects will need to be implement on production at deployment.
need some help in regards to writing them so that the root domain is inferred
based on a regex so that the same .htaccess file can be used on development,
test and production

/en/browse -> /en/explore 301
/de/browse -> /de/explore 301

/en/help -> /en/contributor 301
/de/help -> /de/contributor 301

/en/help/collections ->  410
/de/help/collections ->  410

/en/help/demo ->  /en/contributor 301
/de/help/demo ->  /de/contributor 301

/en/help/form ->  /en/contributor 301
/de/help/form ->  /de/contributor 301

/en/help/privacy -> /en/about/privacy 301
/de/help/privacy -> /de/about/privacy 301

/en/help/search -> /en/explore 301
/de/help/search -> /de/explore 301

/en/library -> /en/about 301
/de/library -> /de/about 301
