#_____________________________
#
#  Ruby & Rails Installation
#_____________________________
#

#  Done via rvm, reasoning explained here:
#  	http://ryanbigg.com/2010/12/ubuntu-ruby-rvm-rails-and-you/



# install curl & use to get rvm

sudo apt-get install curl
curl -L get.rvm.io | bash -s stable --auto



# reload bash profile

. ~/.bash_profile


# find and install required packages (including git via build-essential)

rvm requirements


# Linux only

sudo apt-get install build-essential openssl libreadline6 libreadline6-dev \
curl git-core zlib1g zlib1g-dev libssl-dev libyaml-dev libsqlite3-dev sqlite3 \
libxml2-dev libxslt-dev autoconf libc6-dev ncurses-dev automake libtool bison  \
subversion pkg-config


# install ruby to rvm

rvm install 1.9.3
rvm use 1.9.3

rvm rubygems latest


# 1914 config

rvm install 1.9.2
rvm 1.9.2
rvm gemset create 1914

# check out project
# create file .rvmrc
# add this line to it:

rvm 1.9.2@1914

# exit and reenter directory, rc will ask if you agree (enter y)

cd ..
cd [trunk]
rvm info # (to confirm that it's using the configured gemset for this directory)


# from project root (requires git):

bundle install

rake db:create Ê
bundle exec rake db:migraterake db:schema:loadrake db:sessions:create

# rake db:create may fail on Mac - fix is the following:

MYSQL=/usr/local/mysql/bin
export PATH=$PATH:$MYSQL
export DYLD_LIBRARY_PATH=/usr/local/mysql/lib:$DYLD_LIBRARY_PATH



bundle exec rake i18n:js:exportbundle exec rake ts:config --tracerake ts:indexbundle exec rake assets:expire


# more conf

cp config/environments/development.rb.example  config/environments/development.rb
cp config/initializers/europeana.rb.example config/initializers/europeana.rb

nano config/initializers/europeana.rb

# change to 
Europeana::Search.key = 'LYHEKEFCDB'

cp config/initializers/search_suggestions.rb.example config/initializers/search_suggestions.rb
cp config/initializers/secret_token.example.rb  config/initializers/secret_token.rb

nano config/initializers/secret_token.rb

# change to 

RunCoCo::Application.config.secret_token = 'a secret token for rails that contains at least 30 characters'





rails server




#_____________________________
#
#  ImageMagick (installed already) PUT ON PATH
#_____________________________
#


# On a Mac, a 1-line file in /etc/paths.d will be added to the path.  Imagemagick lives in /opt/local/bin, therefore:

cd /etc/paths.d

sudo nano opt
  /opt/local/bin





#_____________________________
#
#  Database Setup
#_____________________________
#


# mysql - create database

mysql -u root -p
create database cococo;
exit;

# sql dump and import

mysql cococo < Downloads/2012-04-23-cococo.sql


# In ruby project, edit config/database.yml

username: [db password]
password: [db username]
socket: [mysql.sock location - /tmp/mysqld.sock on Mac]




#_____________________________
#
#  Ruby Use
#_____________________________
#

# use a GemSet

rvm use 1.9.3@andy --create --default

# freeze versions and create a gem configuration file see here:
# http://ruby.railstutorial.org/ruby-on-rails-tutorial-book#top


#_____________________________
#
#  Git Use
#_____________________________
#

# One-off, per machine

git config --global user.name "andyjmaclean"
git config --global user.email andyjmaclean@gmail.com
git config --global alias.co checkout

# cd to root of project and run

git init

# (configure .gitignore ???)

# add and commit (locally)

git add .
git commit -m "Initial commit"

# commit (remote) is done with

git push

# check status

git status

# revert (-f) or checkout

git checkout -f



#_____________________________
#
#  Heroku Use
#_____________________________
#

# login

heroku login


# run from project root

heroku create


# send src

git push heroku master

# Messgae if you forget to call "heroku create" 
#   fatal: 'heroku' does not appear to be a git repository
#   fatal: The remote end hung up unexpectedly


# Migrate data

heroku run rake db:migrate

# open browser to view

heroku open




#_____________________________
#
#  Terminal Configuration
#_____________________________
#

# Bash shells read a different profile depending if run locally or ssh-ed into remotely.
#
#
# (menu) Edit | Profile Preferences
# then
# (tab) Title and Command
# check "Run command as a login temrinal"


#_____________________________
#
#  Sphinx Installation
#_____________________________
#

# install

sudo apt-get install sphinxsearch

# configure

# see Dan

# activate (change "START=no" to "START=yes" here)

nano /etc/default/sphinxsearch



#_____________________________
#
#  Eclipse Setup
#_____________________________
#

# (menu) Help | Install New Software...
#
# (select) work with:
#
#   Indigo - http://download.eclipse.org/releases/indigo
#   Indigo - http://download.eclipse.org/releases/juno
#   etc.
#
# Check this:
#   Programming Languages ->     Dynamic Languages Toolkit - Ruby Development Tools
#
# (restart)
#
# (toolbar) Run Configurations...
# (select) Ruby Script
# (button) New Launch Configuration...
# (tab) Interpreter
# (button) Installed Interpreters
# (button) Add
# Add a line like the following, give a name, save and delete redundant configuration

~/.rvm/rubies/ruby-1.9.3-p392/bin/ruby



#_____________________________
#
#  Database Setup
#_____________________________
#




