<%= semantic_form_for contribution do |form| %>
  <%= form.inputs :metadata, :id => 'metadata' do %>
    <%= form.input :title %>
    <%= form.semantic_fields_for :metadata do |metadata| %>
       <%= render :partial => '/metadata_records/form_fields', :locals => { :form => metadata, :cataloguing => false } %>
    <% end %>
  <% end %>
  
  <%- if current_user.may_catalogue_contribution?(contribution) && metadata_record_fields(true).present? -%>
    <%= form.inputs :cataloguing_metadata do %>
      <%= form.semantic_fields_for :metadata do |metadata| %>
        <%= render :partial => '/metadata_records/form_fields', :locals => { :form => metadata, :cataloguing => true } %>
      <% end %>
    <% end %>
  <%- end -%>
  
  <%= form.buttons do %>
    <%= redirect_field %>
    <%- unless form.object.submitted? -%>
      <%= form_previous_step_link (new_contribution_path) %>
    <%- end -%>
    <%= form.commit_button :label => (form.object.submitted? ? t('formtastic.actions.contribution.update') : t('formtastic.actions.contribution.save_draft')) %>
    <%= form_cancel_link (contribution.new_record? ? contributor_dashboard_path : contribution) %>
  <% end %>
<% end %>

