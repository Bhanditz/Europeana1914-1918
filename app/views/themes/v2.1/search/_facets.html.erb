<%
	html = form_tag({}, { :method => :get }) do
		form = '<ul id="facets">'
			if search_filters_present?
				form += '<li class="filter-section">'
					form += render :partial => 'search/filters', :locals => { :query => query, :facets => facets, :provider => provider }
				form += '</li>'
			end

			unless facets.blank?
				form += '<li class="refine-section"><h2>' + t('views.search.facets.refine_results') + ':</h2></li>'
				form += '<li>'
					#form += '<h3><a href="" class="facet-section icon-arrow-6" rel="nofollow">' + t('common.labels.add-keywords') + '</a></h3>'
					form += '<h3 class="facet-section icon-arrow-6">' + t('common.labels.add-keywords') + '</h3>'
					form += '<ul>'
						form += '<li><input type="text" name="qf[q][]"/><input type="submit" value="' + t('actions.add') + '" class="button"/></li>'
					form += '</ul>'
				form += '</li>'

				for facet in facets
					if facet['fields'].present?
						form += '<li>'
							form += '<h3 class="facet-section icon-arrow-7">' + facet['label']
							#form += '<h3>'
								#form += link_to facet['label'], '', :class => "facet-section icon-arrow-7", :rel => "nofollow"
							form += '</h3>'

							form += '<ul>'
								showInfo = false
								for row in facet['fields']
									form += '<li>'
										form += '<h4>'
											if provider == '/collection' && facet["name"].upcase == 'RIGHTS'
												rowLabel = rightsLabel( row['label'] )
											elsif provider == '/collection' && facet["name"].upcase == 'LANGUAGE'
												rowLabel = languageLabel(row['label'])
											elsif provider == '/collection' && facet["name"].upcase == 'COUNTRY'
												rowLabel = row['label'].split.map(&:capitalize)*' '
											else
												rowLabel = row['label']
											end

											# Single selection pseudo-facet
											if facet_is_single_select?(facet["name"])

												if (facet_row_selected?(facet["name"], row["search"]) && (provider == '/collection') && row['search'].to_s == 'a' )
													showInfo = true
												end

												if facet_row_selected?(facet["name"], row["search"])
													form += '<label class="remove-facet bold" title="' + t('actions.remove') + '">'
														form += radio_button_tag 'qf[' + facet['name'] + '][]', row['search'], true
														form += row['label']
													form += '</label>'
													#form += radio_button_tag "qf[#{facet['name']}]", row['search'], true
													#form += link_to_remove_facet_row(facet['name'], row['search'], "<label class=\"bold\">#{rowLabel}</label>".html_safe, { :title => t('actions.remove'), :class => 'remove-facet bold' })
												else
													form += '<label>'
														form += radio_button_tag 'qf[' + facet['name'] + '][]', row['search']
														form += row['label']
													form += '</label>'
													#form += radio_button_tag "qf[#{facet['name']}]", row['search']
													#form += link_to_facet_row(facet['name'], row['search'], "<label>#{row['label']}</label>".html_safe)
												end

											else

												# checkboxes
												if facet_row_selected?(facet['name'], row['search'])
													form += '<label class="remove-facet bold" title="' + t('actions.remove') + '">'
														form += check_box_tag 'qf[' + facet['name'] + '][]', row['search'], true
														form += rowLabel
													form += '</label>'
													#form += check_box_tag "qf[#{facet['name']}][]", row['search'], true
													#form += link_to_remove_facet_row(facet['name'], row['search'], "<label class=\"bold\">#{rowLabel}</label>".html_safe, { :title => t('actions.remove'), :class => 'remove-facet bold' })
												else
													form += '<label>'
														form += check_box_tag 'qf[' + facet['name'] + '][]', row['search']
														form += rowLabel + ' (' + row['count'].to_s + ')'
													form += '</label>'
													#form += check_box_tag "qf[#{facet['name']}][]", row['search']
													#form += link_to_facet_row(facet['name'], row['search'], "<label>#{rowLabel} (#{row['count']})</label>".html_safe)
												end

											end # if facet_is_single_select?(facet["name"])
										form += '</h4>'
									form += '</li>'
								end # for row in facet['fields']

								if showInfo
									form += '<li class="facet-info">' + t('views.search.facets.europeana.source_info') + '</li>'
								end
							form += '</ul>'
						form += '</li>'
					end # if facet['fields'].present?
				end # for facet in facets

				form += hidden_field_tag 'q', query
				form += hidden_field_tag 'count', params['count']
				#form += submit_tag t('actions.submit'), :name => nil, :style => "visibility:hidden"
				form += submit_tag t('actions.submit'), :name => nil
			end # unless facets.blank?
		form += '</ul>'
		form.html_safe
	end # form_tag({}, { :method => :get }) do
-%>
<%= html.html_safe -%>
