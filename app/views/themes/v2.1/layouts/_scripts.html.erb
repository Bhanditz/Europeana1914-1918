<%

  #script
  script = "\n" + 'var' + "\n"
  script += "themePath = '/assets/" + session[:theme] + "/'," + "\n"
  script += 'switchTo5x = true;' + "\n\n" # for share-this

  script += 'window.RunCoCo = {};' + "\n"
  script += "RunCoCo.siteUrl = '" + configuration(:site_url) + "';" + "\n"
  script += "RunCoCo.relativeUrlRoot = '" + configuration(:relative_url_root) + "';" + "\n"
  script += "RunCoCo.gaId = '" + configuration(:google_analytics_key) + "';" + "\n"
  script += "RunCoCo.locale = '" + I18n.locale.to_s + "';" + "\n"

  if @contribution && @contribution.ready_to_submit?
    script += "RunCoCo.ready_for_submit = true;" + "\n"
  end

  if content_for?(:javascripts_translate)
    script += "RunCoCo.bing_translate_key = '" + configuration(:bing_translate_key) + "';" + "\n"
  end

  if @attachment
    script += "RunCoCo.contribution = {" + "\n"
      script += "\ttitle: '" + @attachment.contribution.title.gsub("'", "\\\\'") + "'," + "\n"
      script += "\tmetadata: " + raw( metadata_json(@attachment.contribution) ) + "\n"
    script += "};\n"
  end

  if content_for?(:javascripts_uploadify) && configuration(:uploadify)
    script += "RunCoCo.uploadify_settings = {" + "\n"
      script += "\tmaxUploadSize: " + configuration(:max_upload_size).to_s + ",\n"
      script += "\tfileExt: '" + uploadify_file_extensions + "',\n"
      script += "\tfileDesc: '" + uploadify_file_desc + "',\n"
      script += "\tscript: '" + contribution_attachments_path(@contribution) + "'\n"
    script += "};\n"

    if protect_against_forgery?
      script += "RunCoCo.authenticityToken = '" + form_authenticity_token + "';" + "\n"
    end

    script += "RunCoCo.sessionKeyName = '" + session_key_name + "';" + "\n"
    script += "RunCoCo.sessionKey = '" + cookies[session_key_name] + "';" + "\n"
  end

  if content_for?( :lat_long )
    script += "RunCoCo.latLong = [" + content_for( :lat_long ) + "];" + "\n"
  end

  if content_for?( :map_zoom )
    script += "RunCoCo.mapZoom = " + content_for( :map_zoom ) + ";" + "\n"
  end

  if content_for?( :map_placename )
    script += "RunCoCo.mapPlacename = '" + content_for( :map_placename ) + "';" + "\n"
  end

  if current_user.role.name === 'cataloguer'
    script += "RunCoCo.cataloguer = true;" + "\n"
  end


  # script includes
  script_includes = ( theme_javascript_include_tag 'application' ) + "\n"

  if content_for?(:javascripts_translate)
    script_includes += ( theme_javascript_include_tag 'translator' ) + "\n"
  end

  if content_for?(:javascripts_gmap)
    script_includes += ( javascript_include_tag 'https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places' ) + "\n"
    script_includes += ( theme_javascript_include_tag 'gmap' ) + "\n"
  end

  if configuration(:uploadify) && content_for?(:javascripts_uploadify)
    script_includes += ( theme_javascript_include_tag 'uploadify' ) + "\n"
  end

  if content_for?(:javascripts_shares)
    script_includes += ( javascript_include_tag '//w.sharethis.com/button/buttons.js' ) + "\n"
  end

  if content_for?(:javascripts_lightbox)
    script_includes += ( theme_javascript_include_tag 'lightbox' ) + "\n"
  end

  if content_for?(:javascripts_europeana_carousel)
    script_includes += ( theme_javascript_include_tag 'europeana-carousel' ) + "\n"
  end

  if content_for?(:javascripts_annotorious)
    script_includes += ( theme_javascript_include_tag 'annotorious' ) + "\n"
  end

  if content_for?(:javascripts_europeana_leaflet)
    script_includes += ( theme_javascript_include_tag 'europeana-leaflet' ) + "\n"
  end

  if content_for?( :lat_long )
    script_includes += ( theme_javascript_include_tag 'leaflet' ) + "\n"
    script_includes += ( javascript_include_tag 'https://maps.googleapis.com/maps/api/js?v=3.2&sensor=false' ) + "\n"
  end

  if content_for?( :reveal )
    script_includes += ( theme_javascript_include_tag 'reveal' ) + "\n"
  end


  # script2
  # need this here because loading I18n will overwrite this value
  # if value is set before I18n is loaded
  script2 = "\n" + "I18n.locale = '" + I18n.locale.to_s + "';" + "\n"

  # for share this
  script2 += "if ( window.stLight ) {"
    script2 += "\tstLight.options({ publisher: '" + configuration(:sharethis_id) + "' }); "
  script2 += "}" + "\n"

  script2 += "if ( ( /iPad/.test( navigator.platform ) && navigator.userAgent.indexOf( \"AppleWebKit\" ) > -1 ) ) { $('.remix').hide(); }" + "\n"


  # script_includes2
  script_includes2 = "\n"

  if content_for?(:javascripts_page)
    script_includes2 += theme_javascript_include_tag "eu/europeana/pages/" + content_for(:javascripts_page)
  end

%>

<%= javascript_tag( script ) + "\n" %>
<%= script_includes.html_safe %>
<%= javascript_tag( script2 ) %>
<%= script_includes2.html_safe %>