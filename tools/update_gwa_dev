#!/bin/sh

#=======================================
#
#  Updates dev environment after svn changes
#  triggered from Hudson
#
#  Copyright: Europeana 2012
#  License: EUPL
#  By:  Jacob.Lundqvist@kb.nl
#


# need to run this as root...


echo
echo "=============   shutting down apache first   ==========="
echo "=============   (will give passanger time to exit)   ==========="
echo
/etc/init.d/apache2 stop


echo
echo "=============   svn update   ==========="
echo
cd /var/www/cococo
svn up

echo
echo "=============   remove all gems   ==========="
echo
gem list | cut -d" " -f1 | xargs gem uninstall -aIx


echo
echo "=============   install some basic gems   ==========="
echo
gem install bundle rake passenger

# We also use a gem passenger, but it depends on a manual compile step
# so this must be manually updated for apache interaction
#gem install passenger
#passenger-install-apache2-module
# reading the output of passenger-install-apache2-module will 
# tell you how to load the passenger module into apache


echo
echo "=============   bundle install   ==========="
echo
rm Gemfile.lock
bundle install


/etc/init.d/apache2 start
